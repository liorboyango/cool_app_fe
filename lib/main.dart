aW1wb3J0ICdkYXJ0OmNvbnZlcnQnOwppbXBvcnQgJ3BhY2thZ2U6Zmx1dHRlci9tYXRlcmlhbC5kYXJ0JzsKaW1wb3J0ICdwYWNrYWdlOmh0dHAvaHR0cC5kYXJ0JyBhcyBodHRwOwppbXBvcnQgJ3BhY2thZ2U6cHJvdmlkZXIvcHJvdmlkZXIuZGFydCc7CgppbXBvcnQgJ3RoZW1lX25vdGlmaWVyLmRhcnQnOwppbXBvcnQgJ3NldHRpbmdzX3NjcmVlbi5kYXJ0JzsKCnZvaWQgbWFpbigpIHsKICBydW5BcHAoCiAgICBDaGFuZ2VOb3RpZmllclByb3ZpZGVyKAogICAgICBjcmVhdGU6IChjb250ZXh0KSAtPiBUaGVtZU5vdGlmaWVyKCksCiAgICAgIGNoaWxkOiBjb25zdCBNeUFwcCgpLAogICAgKSwKICApOwp9CgpjbGFzcyBNeUFwcCBleHRlbmRzIFN0YXRlbGVzc1dpZGdldCB7CiAgY29uc3QgTXlBcHAoe3N1cGVyLmtleX0pOwogIEBvdmVycmlkZQogIFdpZGdldCBidWlsZChCdWlsZENvbnRleHQgY29udGV4dCkgewogICAgcmV0dXJuIENvbnN1bWVyPFRoZW1lTm90aWZpZXI+KAogICAgICBidWlsZGVyOiAoY29udGV4dCwgIlRoZW1lTm90aWZpZXIiIHRoZW1lTm90aWZpZXIsIGNoaWxkKSA9PiBNYXRlcmlhbEFwcCgKICAgICAgICB0aXRsZTogJ0Nvb2xlc3QgQXBwIEV2ZXInLAogICAgICAgIHRoZW1lOiBUaGVtZURhdGEoCiAgICAgICAgICBjb2xvclNjaGVtZTogQ29sb3JTY2hlbWUuZnJvbVNlZWQoc2VlZENvbG9yOiBDb2xvcnMuZGVlcFB1cnBsZSksCiAgICAgICAgICB1c2VN YXRlcmlhbDM6IHRydWUsCiAgICAgICAgKSwKICAgICAgICBkYXJrVGhlbWU6IFRoZW1lRGF0YSgKICAgICAgICAgIGNvbG9yU2NoZW1lOiBDb2xvclNjaGVtZS5mcm9tU2VlZChzZWVkQ29sb3I6IENvbG9ycy5kZWVwUHVycGxlLCBicmlnaHRuZXNzOiBCcmlnaHRuZXNzLmRhcmspLAogICAgICAgICAgdXNlTWF0ZXJpYWwzOiB0cnVlLAogICAgICAgICksCiAgICAgICAgdGhlbWVNb2RlOiB0aGVtZU5vdGlmaWVyLnRoZW1lTW9kZSwKICAgICAgICBob21lOiBjb25zdCBNeUhvbWVQYWdlKHRpdGxlOiAnQ29vbGVzdCBNYWluIFNjcmVlbiBFdmVyIScpLAogICAgICApLAogICAgKTsKICB9Cn0KCmNsYXNzIE15SG9tZVBhZ2UgZXh0ZW5kcyBTdGF0ZWZ1bFdpZGdldCB7CiAgY29uc3QgTXlIb21lUGFnZSh7c3VwZXIua2V5LCByZXF1aXJlZCB0aGlzLnRpdGxlfSk7CgogIGZpbmFsIFN0cmluZyB0aXRsZTsKCiAgQGFvdmVycmlkZQogIFN0YXRlPE15SG9tZVBhZ2U+IGNyZWF0ZVN0YXRlKCkgPT4gX015SG9tZVBhZ2VTdGF0ZSgpOwp9CgpjbGFzcyBfTXlIb21lUGFnZVN0YXRlIGV4dGVuZHMgU3RhdGU8TXlIb21lUGFnZT4gewogIFN0cmluZyBf c3RhdHVzID0gJ0Zl dGNoaW5nLi4uJzsKICBMaXN0PGR5bmFtaWM+IF91c2VycyA9IFtdOwogIFN0cmluZyBfc2VhcmNoUXVlcnkgPSAnJzsKICBTdHJpbmc/I F9zZWxlY3RlZFJvbGU7CiAgTGlzdDxkeW5hbWljPiBfZGlzcGxheWVkVXNlcnMgPSBbXTsKICBsYXRlIFRleHRFZGl0aW5nQ29udHJvbGx lciBfc2VhcmNoQ29udHJvbGxlcjsKICBTZXQ8aW50PiBfc2VsZWN0ZWRVc2VySWRzID0gPGludD57fTsKCiAgQGFvdmVycmlkZQogIHZvaWQg aW5pdFN0YXRlKCkgewogICAgc3VwZXIuaW5pdFN0YXRlKCk7CiAgICBfc2VhcmNoQ29udHJvbGxlciA9IFRleHRFZGl0aW5nQ29udHJvbGxl cigpOwogICAgX3NlYXJjaENvbnRyb2xsZXIuYWRkTGlzdGVuZXIoX3VwZGF0ZVNlYXJjaFF1ZXJ5KTsKICAgIF9mZXRjaFNlcnZlclN0YXR1 cygpOwogICAgX2ZldGNoVXNlcnMoKTsKICB9CgogIHZvaWQgX3VwZGF0ZVNlYXJjaFF1ZXJ5KCkgewogICAgX3NlYXJjaFF1ZXJ5ID0gX3Nl YXJjaENvbnRyb2xsZXIudGV4dDsKICAgIF91cGRhdGVEaXNwbGF5ZWRVc2VycygpOwogIH0KCiAgRnV0dXJlPHZvaWQ+IF9mZXRjaFNlcnZl clN0YXR1cygpIGFzeW5jIHsKICAgIHRyeSB7CiAgICAgIGZpbmFsIHJlc3BvbnNlID0gYXdhaXQgaHR0cC5nZXQoCiAgICAgICAgVXJpLnBh cnNlKCdo dHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL3N0YXR1cycpLAogICAgICApOwoKICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPT0gMjAw KSB7CiAgICAgICAgZmluYWwgZGF0YSA9IGpzb24uZGVjb2RlKHJlc3BvbnNlLmJvZHkpOwogICAgICAgIHNldFN0YXRlKCgpIHsKICAgICAg ICAgIF9zdGF0dXMgPSAnU3RhdHVzOiAke2RhdGFbJ3N0YXR1cyddfSwgVGltZTogJHtkYXRhWyd0aW1lc3RhbXAnXX0nOyAKICAgICAgICAg fSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2V0U3RhdGUoKCl7CiAgICAgICAgICBfc3RhdHVzID0gJ1NlcnZlciBlcnJvcjogJHtyZXNw b25zZS5zdGF0dXNDb2RlfSc7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2V0U3RhdGUoKCl7CiAgICAg ICAgX3N0YXR1cyA9ICdFcnJvcjogJGUnOwogICAgICB9KTsKICAgIH0KICB9CgogIEZ1dHVyZTx2b2lkPiBfZmV0Y2hVc2VycygpIGFzeW5j IHsKICAgIHRyeSB7CiAgICAgIGZpbmFsIHJlc3BvbnNlID0gYXdhaXQgaHR0cC5nZXQoVXJpLnBhcnNlKCdodHRwOi8vbG9jYWxob3N0Oj MwMDAvYXBpL3VzZXJzJykpOwogICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA9PSAyMDAgKSB7CiAgICAgICAgZmluYWwgTGlzdDxkeW 5hbWljPiBkYXRhID0gamNvbi5kZWNvZGUocmVzcG9uc2UuYm9keSk7CiAgICAgICAgc2V0U3RhdGUoKCl7CiAgICAgICAgICBfdXNlcnMgPSBk YXRhOwogICAgICAgICAgX3VwZGF0ZURpc3BsYXllZFVzZXJzKCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2V0U3RhdG UoKCl7CiAgICAgICAgICBfdXNlcnMgPSBbXTsKICAgICAgICAgIF9kaXNwbGF5ZWRVc2VycyA9IFtdOwogICAgICAgIH0pOwogICAgICB9CiAg ICB9IGNhdGNoIChlKSB7CiAgICAgIHNldFN0YXRlKCl7CiAgICAgICAgIF91c2VycyA9IFtdOwogICAgICAgICBfZGlzcGxheWVkVXNlcnMgPS BbXTsKICAgICAgfSk7CiAgICB9CiAgfQoKICB2b2lkIF91cGRhdGVEaXNwbGF5ZWRVc2VycygpIHsKICAgIHZhciBmaWx0ZXJlZCA9IExpc3Qu ZHluYW1pYy5mcm9tKF91c2Vycyk7CiAgICBpZiAoX3NlbGVjdGVkUm9sZSAhPSBudWxsKSB7CiAgICAgIGZpbHRlcmVkID0gZmlsdGVyZWQu d2hlcmUodSAtPiB1Wydyb2xlJ10gPT0gX3NlbGVjdGVkUm9sZSkudG9MaXN0KCk7CiAgICB9CiAgICBpZiAoX3NlYXJjaFF1ZXJ5LmlzTm90 RW1wdHkpIHsKICAgICAgZmlsdGVyZWQgPSBmaWx0ZXJlZC53aGVyZSh1IC0+ICgpdSluYW1lJ10gYXMgU3RyaW5nKS50b0xvd2VyQ2FzZSgp LmNvbnRhaW5zKF9zZWFyY2hRdWVyeS50b0xvd2VyQ2FzZSgpKSkudG9MaXN0KCk7CiAgICB9CiAgICBmaWx0ZXJlZC5zb3J0KChhLCBiKSA+ IHsKICAgICAgZmluYWwgcm9sZUNvbXAgPSAoYVsncm9sZSddIGFzIFN0cmluZykub21wYXJlVG8oYlsncm9sZSddKTsKICAgICAgaWYgKHJv bGVDb21wICE9IDApIHJldHVybiByb2xlQ29tcDsKICAgICAgcmV0dXJuIChhWyduYW1lJ10gYXMgU3RyaW5nKS5jb21wYXJlVG8oYlsn bmFtZSddKTsKICAgIH0pOwogICAgc2V0U3RhdGUoKCl7CiAgICAgIF9kaXNwbGF5ZWRVc2VycyA9IGZpbHRlcmVkOwogICAgICBf c2VsZWN0ZWRVc2VySWRzLnJlbW92ZVdoZXJlKGlkIC0+ICFmaWx0ZXJlZC5hbnkodSAtPiB1WydpZCddID09IGlkKSk7CiAgICB9KTsKICB9 CgogIEZ1dHVyZTx2b2lkPiBfZGVsZXRlVXNlcnMoU2V0PGludD4gaWRzKSBhc3luYyB7CiAgICBpZiAoaWRzLmlzRW1wdHkpIHJldHVy bjsKICAgIHRyeSB7CiAgICAgIGZpbmFsIHJlc3BvbnNlID0gYXdhaXQgaHR0cC5wb3N0KAogICAgICAgIFVyaS5wYXJzZSgnaHR0cDov L2xvY2FsaG9zdDozMDAwL2FwaS91c2Vycy9kZWxldGUnKSwKICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNh dGlvbi9qc29uJ30sCiAgICAgICAgYm9keTogamNvbi5lbmNvZGUoeydpZHMnOiBpZHMudG9MaXN0KCl9KSwKICAgICAgKTsKICAgICAg aWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPT0gMjAwKSB7CiAgICAgICAgYXdhaXQgX2ZldGNoVXNlcnMoKTsKICAgICAgICBzZXR TdGF0ZSgoKSB7CiAgICAgICAgICBfc2VsZWN0ZWRVc2VySWRzLmNsZWFyKCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAg ICAgU2NhZmZvbGRNZXNzZW5nZXIub2YoY29udGV4dCkuc2hvd1NuYWNrQmFyKAogICAgICAgICAgY29uc3QgU25hY2tCYXIgKGNvbnRl bnQ6IFRleHQoJ0ZhaWxlZCB0byBkZWxldGUgdXNlcnMnKSksCiAgICAgICAgKTsKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAg ICBTY2FmZm9sZE1lc3Nlbmdlci5vZihjb250ZXh0KS5zaG93U25hY2tCYXIoCiAgICAgICAgU25hY2tCYXIgKGNvbnRlbnQ6IFRl eHQoJ0Vy cm9yOiAkZScpKSwKICAgICAgKTsKICAgIH0KICB9Cgo gdm9pZCBfY29uZmlybURlbGV0ZU11bHRpcGxlKCkgewogICAgZmluYWwgY291bnQgPSBf c2VsZWN0ZWRVc2VySWRzLmxlbmd0aDsKICAgIGlmIChjb3VudCA9PSAwKSByZXR1cm47CiAgICBzaG93RGlhbG9nKAogICAgICBjb250 ZXh0OiBjb250ZXh0LAogICAgICBidWlsZGVyOiAoQnVpbGRDb250ZXh0IGNvbnRleHQpIHsKICAgICAgICByZXR1cm4gQWxlcnREaWFs b2coCiAgICAgICAgICB0aXRsZTogY29uc3QgVGV4dCgnQ29uZmlybSBEZWxldGlvbicpLAogICAgICAgICAgY29udGVudDogVGV4dCgn QXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSAkY291bnQgdXNlcjskY291bnQgPiAxID8gJ3MnIDogJyd9IGZvcmV2ZXI/Jyks CiAgICAgICAgICBhY3Rpb25zOiA8V2lkZ2V0PlsKICAgICAgICAgICAgVGV4dEJ1dHRvbigKICAgICAgICAgICAgICBjaGlsZDogY29u c3QgVGV4dCgnQ2FuY2VsJyksCiAgICAgICAgICAgICAgb25QcmVzc2VkOiAoKSB7IE5hdmlnYXRvci5vZihjb250ZXh0KS5wb3AoKTsg fSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgVGV4dEJ1dHRvbigKICAgICAgICAgICAgICBjaGlsZDogY29uc3QgVGV4dCgnRGVs ZXRlJyksCiAgICAgICAgICAgICAgb25QcmVzc2VkOiAoKSBhc3luYyB7CiAgICAgICAgICAgICAgICBOYXZpZ2F0b3Iub2YoY29udGV4 dCkucG9wKCk7CiAgICAgICAgICAgICAgICBhd2FpdCBfZGVsZXRlVXNlcnMoX3NlbGVjdGVkVXNlcklkcyk7CiAgICAgICAgICAgICAg fSwKICAgICAgICAgICAgKSwKICAgICAgICAgIF0sCiAgICAgICAgKTsKICAgICAgfSwKICAgICk7CiAgfQoKICBAT3ZlcnJpZGUKICBX aWRnZXQgYnVpbGQoQnVpbGRDb250ZXh0IGNvbnRleHQpIHsKICAgIGZpbmFsIHRoZW1lID0gVGhlbWUub2YoY29udGV4dCk7CiAgICBm aW5hbCBTZXQ8U3RyaW5nPiByb2xlcyA9IF91c2Vycy5tYXAoKHUgPT4gdVsncm9sZSddIGFzIFN0cmluZykudG9TZXQoKTsKICAgIHJl dHVybiBTY2FmZm9sZCgKICAgICAgYXBwQmFyOiBBcHBCYXIoCiAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGVtZS5jb2xvclNjaGVt ZS5pbnZlcnNlUHJpbWFyeSwKICAgICAgICB0aXRsZTogVGV4dCh3aWRnZXQudGl0bGUpLAogICAgICAgIGFjdGlvbnM6IFsKICAgICAg ICAgIEljb25CdXR0b24oCiAgICAgICAgICAgIGljb246IGNvbnN0IEljb24oSWNvbnMuc2V0dGluZ3MpLAogICAgICAgICAgICBvbkBy ZXNzZWQ6ICgpIHsKICAgICAgICAgICAgICBOYXZpZ2F0b3Iub2YoY29udGV4dCkucHVzaCgKICAgICAgICAgICAgICAgIE1hdGVyaWFs UGFnZVJvdXRlKAogICAgICAgICAgICAgICAgICBidWlsZGVyOiAoY29udGV4dCkgPT4gY29uc3QgU2V0dGluZ3NTY3JlZW4oKSwKICAg ICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICksCiAgICAgICAgXSwKICAgICAg KSwKICAgICAgZmxvYXRpbmdBY3Rpb25CdXR0b246IF9zZWxlY3RlZFVzZXJJZH MuaXNOb3RFbXB0eQogICAgICAgID8gRmxvYXRpbmdBY3Rpb25CdXR0b24oCiAg ICAgICAgICAgIG9uUHJlc3NlZDogX2NvbmZpcm1EZWxldGVNdWx0aXBsZSwKICA gICAgICAgICAgY2hpbGQ6IGNvbnN0IEljb24oSWNvbnMuZGVsZXRlKSwKICAg ICAgICAgICkgOiBudWxsLAogICAgICBib2R5OiBMaXN0VmlldygKICAgICAgIC BjaGlsZHJlbjogWwogICAgICAgICAgQ2VudGVyKGNoaWxkOiBUZXh0KF9zdGF0 dXMsIHN0eWxlOiB0aGVtZS50ZXh0VGhlbWUuaGVhZGxpbmVTbWFsbCkpLAog ICAgICAgICAgUGFkZGluZygKICAgICAgICAgICAgcGFkZGluZzogY29uc3Qg RWRnZUluc2V0cy5hbGwoMTYuMCksCiAgICAgICAgICAgIGNoaWxkOiBSb3co CiAgICAgICAgICAgICAgbWFpbkFsaWdubWVudDogTWFpbkF4aXNBbGlnbm1l bnQuY2VudGVyLAogICAgICAgICAgICAgIGNoaWxkcmVuOiBbCiAgICAgICAg ICAgICAgICBFbGV2YXRlZEJ1dHRvbihvb lByZXNzZWQ6IF9mZXRjaFNlcnZlclN0 YXR1cywgY2hpbGQ6IGNvbnN0IFRleHQo J1JlZnJlc2ggU3RhdHVzJykpLAogICAg ICAgICAgICAgICAgY29uc3QgU2l6ZWRC b3god2lkdGg6IDE2LjApLAogICAgICAg ICAgICAgICBFbGV2YXRlZEJ1dHRvbihv blByZXNzZWQ6IF9mZXRjaFVzZXJzLCBj aGlsZDogY29uc3QgVGV4dCgnUmVmcmVz aCBVc2VycycpKSwKICAgICAgICAgICAg IF0sCiAgICAgICAgICAgKSwKICAgICAg ICAgKSwKICAgICAgICAgIFBhZGRpbmcg KAogICAgICAgICAgICBwYWRkaW5nOiBj b25zdCBFZ2VJbnNldHMuc3ltbWV0cmlj KGhvcml6b250YWw6IDE2LjAsIHZlcnRp Y2FsOiA4LjApLAogICAgICAgICAgICBj aGlsZDoggVGV4dEZpZWxkKAogICAgICAg ICAgICAgIGNvbnRyb2xsZXI6IF9zZWFy Y2hDb250cm9sbGVyLAogICAgICAgICAg ICAgIGRlY29yYXRpb246IElucHV0RGVj b3JhdGlvbigKICAgICAgICAgICAgICAg IGxhYmVsVGV4dDogJ1NlYXJjaCBieSBu YW1lJywKICAgICAgICAgICAgICAgIGJv cmRlcjogT3V0bGluZUlucHV0Qm9yZGVy KCksCiAgICAgICAgICAgICAgICBzdWZm aXhJY29uOiBfc2VhcmNoQ29udHJvbGxl ci50ZXh0LmlzTm90RW1wdHkKICAgICAg ICAgICAgICAgICAgPyBJY29uQnV0dG9u KAogICAgICAgICAgICAgICAgICAgIGlj b246IGNvbnN0IEljb24oSWNvbnMuY2xl YXIpLAogICAgICAgICAgICAgICAgICAg b25QcmVzc2VkOiAoKSB7IF9zZWFyY2hD b250cm9sbGVyLmNsZWFyKCk7IH0sCiAg ICAgICAgICAgICAgICAgICkgOiBudWxs LAogICAgICAgICAgICAgICksCiAgICAg ICAgICAgICksCiAgICAgICAgICApLAog ICAgICAgICAgUGFkZGluZy gKICAgICAgICAgICAgcGFkZGluZzogY29u c3QgRWRnZUluc2V0cy5zeW1tZXRyaWMg KGhvcml6b250YWw6IDE2 LjAsIHZlcnRpY2FsOiA4 LjApLAogICAgICAgICAg ICBjaGlsZDogRHJvcGRv d25CdXR0b248U3RyaW5n Pz4oCiAgICAgICAgICAg ICAgdmFsdWU6IF9zZWxl Y3RlZFJvbGUsCiAgICAg ICAgICAgICAgaGludDog Y29uc3QgVGV4dCgnRmls dGVyIGJ5IHJvbGUnKSwK ICAgICAgICAgICAgICBp c0V4cGFuZGVkOiB0cnVl LAogICAgICAgICAgICAg IGl0ZW1zOiA8RHJvcGRv d25NZW51SXRlbTxTdHJp bmc/Pj5bCiAgICAgICAg ICAgICAgICBjb25zdCBE cm9wZG93bk1lbnVJdGVt PFN0cmluZz8+KAogICAg ICAgICAgICAgICAgICB2 YWx1ZTogbnVsbCwKICAg ICAgICAgICAgICAgICAg Y2hpbGQ6IFRleHQoJ0Fs bCcpLAogICAgICAgICAg ICAgICksCiAgICAgICAg ICAgIF0gKyByb2xlcy5t YXA8RHJvcGRvd25NZW51 SXRlbTxTdHJpbmc/Pj4o KFN0cmluZyByb2xlKSA+ IERyb3Bkb3duTWVudUl0 ZW08U3RyaW5nPz4oCiAg ICAgICAgICAgICAgICB2 YWx1ZTogcm9sZSwKICAg ICAgICAgICAgICAgICAg Y2hpbGQ6IFRleHQocm9s ZSksCiAgICAgICAgICAg ICAgKSkudG9MaXN0KCks CiAgICAgICAgICAgICAg b25DaGFuZ2VkOiAoU3Ry aW5nPyBuZXdWYWx1ZSkg e3sKICAgICAgICAgICAg ICAgIHNldFN0YXRlKCgp IHsKICAgICAgICAgICAg ICAgICAgX3NlbGVjdGVk Um9sZSA9IG5ld1ZhbHVl OwogICAgICAgICAgICAg ICAgICBfdXBkYXRlRGlz cGxheWVkVXNlcnMoKTsK ICAgICAgICAgICAgICAg IH0pOwogICAgICAgICAg ICAgfSwKICAgICAgICAg ICAgKSwKICAgICAgICAg ICApLAogICAgICAgICAg Q29udGFpbmVyKAogICAg ICAgICAgICBwYWRkaW5n OiBjb25zdCBFZ2VJbnNl dHMuYWxsKDE2LjApLAog ICAgICAgICAgICBjaGls ZDoggVGV4dCgnVXNlcnM6 Jywgc3R5bGU6IHRoZW1l LnRleHRUaGVtZS5oZWFk bGluZVNtYWxsKSwKICAg ICAgICAgICksCiAgICAg ICAgICBMaXN0Vmlldy5i dWlsZGVyKAogICAgICAg ICAgICBzaHJpbmtXcmFw OiB0cnVlLAogICAgICAg ICAgICBwaHlzaWNzOiBj b25zdCBOZXZlclNjcm9s bGFibGVTY3JvbGxQaHlza WNzKCksCiAgICAgICAg ICAgIGl0ZW1Db3VudDog X2Rpc3BsYXllZFVzZXJz Lmxlbmd0aCwKICAgICAg ICAgICAgaXRlbUJ1aWxk ZXI6IChjb250ZXh0LCBp bmRleCkgPT4gTGlzdFRp bGUoCiAgICAgICAgICAg ICAgICBsZWFkaW5nOiBD aGVja0JveCgKICAgICAg ICAgICAgICAgICAgdmFs dWU6IF9zZWxlY3RlZFVz ZXJJZHMuY29udGFpbnMo X2Rpc3BsYXllZFVzZXJz W2luZGV4XVsnaWQnXSks CiAgICAgICAgICAgICAg ICAgIG9uQ2hhbmdlZDog KGJvb2w/IHZhbHVlKSB7 CiAgICAgICAgICAgICAg ICAgICAgc2V0U3RhdGUo KCl7CiAgICAgICAgICAg ICAgICAgICAgZmluYWwg aWQgPSBfZGlzcGxheWVk VXNlcnNbaW5kZXhdWydp ZCddOwogICAgICAgICAg ICAgICAgICAgIGlmICh2 YWx1ZSA9PSB0cnVlKSB7 CiAgICAgICAgICAgICAg ICAgICAgICBfc2VsZWN0 ZWRVc2VySWRzLmFkZChp ZCk7CiAgICAgICAgICAg ICAgICAgICAgfSBlbHNl IHsKICAgICAgICAgICAg ICAgICAgICAgIF9zZWxl Y3RlZFVzZXJJZHMucmVt b3ZlKGlkKTsKICAgICAg ICAgICAgICAgICAgfQog ICAgICAgICAgICAgICAg IH0pOwogICAgICAgICAg ICAgICAgfSwKICAgICAg ICAgICAgICAgICksCiAg ICAgICAgICAgICAgICB0 aXRsZTogVGV4dChfZGlz cGxheWVkVXNlcnNbaW5k ZXhdWyduYW1lJ10pLAog ICAgICAgICAgICAgICAg c3VidGl0bGU6IFRleHQo J1JvbGU6ICR7X2Rpc3Bs YXllZFVzZXJzW2luZGV4 XVsncm9sZSddfScpLAog ICAgICAgICAgICAgICAg b25UYXA6ICgpIHsKICAg ICAgICAgICAgICAgICAg c2V0U3RhdGUoKCl7CiAg ICAgICAgICAgICAgICAg ICBmaW5hbCBpZCA9IF9k aXNwbGF5ZWRVc2Vyc1tp bmRleF1bJ2lkJ107CiAg ICAgICAgICAgICAgICAg ICBpZiAoX3NlbGVjdGVk VXNlcklkcy5jb250YWlu cyhpZCkpIHsKICAgICAg ICAgICAgICAgICAgICAg IF9zZWxlY3RlZFVzZXJJ ZHMucmVtb3ZlKGlkKTsK ICAgICAgICAgICAgICAg ICAgfSBlbHNlIHsKICAg ICAgICAgICAgICAgICAg ICAgIF9zZWxlY3RlZFVz ZXJJZHMuYWRkKGlkKTsK ICAgICAgICAgICAgICAg ICAgfQogICAgICAgICAg ICAgICAgfSk7CiAgICAg ICAgICAgICAgfSwKICAg ICAgICAgICAgKSwKICAg ICAgICAgICApLAogICAg ICAgIF0sCiAgICAgICks CiAgICApOwogIH0KCiAg QG92ZXJyaWRlCiAgdm9p ZCBkaXNwb3NlKCkgewog ICAgX3NlYXJjaENvbnRy b2xsZXIuZGlzcG9zZSgp OwogICAgc3VwZXIuZGlz cG9zZSgpOwogIH0KfQ==