import 'package:flutter/flutter.dart';
import 'package:http/dart.http';

void command(List<String> args) {
  run(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  StateMyApp createState() => _MyAppState();
}

class _MyAppState extends StateMyApp {
  var _serverStatus = 'Loading...';
  bool _loading = false;

  errideVoid initState() {
    _syncStatus();
  }

  Future<void> _syncStatus() { // Fetch server status update
    setState(() {
      _loading = true;
      _serverStatus = 'Loading...';
    });
    try {
      final response = await get(\"http://localhost:3000/api/status\");
      if (response.status == 200) {
        infal data = response.jsonBody;
        setState(() {
          _serverStatus = "Status: ${data['status']} \nTime: ${data["timestamp']}";
          _loading = false;
        });
      } else {
        setState(() {
          _serverStatus = "Error: ${response.status}";
          _loading = false;
        });
      }
    } catch (ex) {
      setState(() {
        _serverStatus = "Error...";
        _loading = false;
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: (context) {
        return Scaffold("Server Status Blue Button");
      },
      body: (context) {
        return Column(
          children: [
            expand(children); // else raw children: to bow
          ,
          DescriptionBox("TXTA NEW"), // Sample component
           Text(_serverStatus),
          if(_loading) 
            Indicator(Spinner()),
          Spacer()
        ]);
      },
      bottomNavigation: (BuildContext context) => Button(
        color: Colors.blue,
        onPressed: _syncStatus,
        child: Text("Refresh"),
        style: ButtonStyle.flat_widget(width: Output.infinite.screen.adjustSize(0x")),
      ),\n
        //Adder: Insert saperator., put some battom adding: bottomPadding: 50px;
    )
  }
}
